---
title: Rotating IPsec Credentials
owner: Security Engineering
---

<strong><%= modified_date %></strong>

This topic describes the process Pivotal recommends to increase deployment security by rotating credentials in the IPsec manifest. Your organizational security policy may specify how often you should apply these changes. 

There are two procedures for credential rotation described in this topic.

* [Procedure 1](#rotate-cert) describes rotating the following credentials specified in your IPsec manifest: 
  * The instance certificate and instance private key <br>
  This procedure requires updating BOSH. It does not include rotating the certificate authority (CA) certificate. 

* [Procedure 2](#rotate-CA) describes rotating your CA certificate in addition to your instance certificate and instance private key. This procedure requires updating BOSH three times.

<p class="note"><strong>Note</strong>: The rolling deploys during these procedures result in minimal deployment downtime.</p>

## <a id="rotate-cert"></a>Procedure 1: Rotate the Instance Certificate and Instance Private Key

Follow the steps below to rotate the instance certificate and instance private key.

1. Generate a new certificate and use your existing IPsec CA certificate to sign the new certificate.

1. Update the instance certificate and the private key fields in your `ipsec-addon.yml` file with new values from the previous step.

1. Run the following command:
  <pre class="terminal">
  $ bosh update runtime-config PATH/MYPRODUCT_ipsec-addon.yml
  </pre>
<p class="note"><strong>Note</strong>: The following step results in a few minutes of application downtime. </p>

1. Navigate to your Ops Manager interface in a browser, and click **Apply Changes**. 

## <a id="rotate-CA"></a>Procedure 2: Rotate the CA Certificate, the Instance Certificate, and Instance Private Key

Follow these steps to rotate the CA certificate, instance certificate, and instance private key.

1. Generate a new CA certificate.

1. Append the newly generated CA certificate under the existing certificate in your `ipsec-addon.yml`.

1. Run the following command:
  <pre class="terminal">$ bosh update runtime-config PATH/MYPRODUCT_ipsec-addon.yml</pre>
<p class="note"><strong>Note</strong>: The following step results in a few minutes of application downtime. </p>

1. Navigate to your Ops Manager interface in a browser, and click **Apply Changes**.

1. Generate a new certificate and use your new CA certificate to sign the new certificate.

1. Update the instance certificate and the private key fields in the your `ipsec-addon.yml` file with new values from above. </p>

1. Run the following command:
  <pre class="terminal">$ bosh update runtime-config PATH/MYPRODUCT_ipsec-addon.yml</pre>
<p class="note"><strong>Note</strong>: The following step results in a few minutes of application downtime. </p>

1. Navigate to your Ops Manager interface in a browser, and click **Apply Changes**.

1. Delete the older CA certificate in the `ipsec-addon.yml` file.

1. Run the following command:
  <pre class="terminal">$ bosh update runtime-config PATH/MYPRODUCT_ipsec-addon.yml</pre>
<p class="note"><strong>Note</strong>: The following step results in a few minutes of application downtime. </p>

1. Navigate to your Ops Manager interface in a browser, and click **Apply Changes**.

