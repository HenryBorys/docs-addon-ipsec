---
title: Rotating Active IPsec Certificates
owner: Security Engineering
---

<strong><%= modified_date %></strong>

This topic describes the process Pivotal recommends to increase deployment security by rotating certificates in the IPsec manifest.

## <a id='why'></a>Why You Need to Rotate Credentials

These are common reasons for rotating credentials:

+ Your organizational security policy may specify how often you should apply these changes. 

+ Your certificates are going to expire. To find the expiration dates on your certificates, see [Checking Certificate Dates](check-dates.html).

## <a id='procedures'></a> About the Procedures

There are two procedures for certificate rotation described in this topic:

* The first procedure describes rotating the instance certificate and instance private key specified in your IPsec manifest, and requires updating BOSH. This procedure does not include rotating the certificate authority (CA) certificate. 

* The second procedure describes rotating your CA certificate in addition to your instance certificate and instance private key. This procedure requires updating BOSH three times.

<p class="note"><strong>Note</strong>: The rolling deploys during these procedures result in minimal deployment downtime.</p>

## <a id="rotate-cert"></a>Procedure 1: Rotate the Instance Certificate and Instance Private Key

Follow the steps below to rotate the instance certificate and instance private key.

1. Generate a new certificate and use your existing IPsec CA certificate to sign the new certificate. 

1. Update the instance certificate and the private key fields in your `ipsec-addon.yml` file 
 with new values from the previous step.

1. Update the runtime config by running one of the following commands:
  * **For Ops Manager v1.10 or earlier:** 
    `bosh update runtime-config PATH_TO_SAVE_THE_RUNTIME_CONFIG`<br><br>
  * **For Ops Manager v1.11 or later:**
    `bosh2 -e BOSH_ENVIRONMENT update-runtime-config PATH_TO_SAVE_THE_RUNTIME_CONFIG`<br>

    <p class="note"><strong>Note</strong>: This step results in a few minutes of app downtime. </p>

1. Navigate to your Ops Manager interface in a browser, and click **Apply Changes**. 

## <a id="rotate-CA"></a>Procedure 2: Rotate the CA Certificate, the Instance Certificate, and Instance Private Key

Follow these steps below to rotate the CA certificate, the instance certificate, and instance private key.

1. Generate a new CA certificate.

1. Append the newly generated CA certificate under the existing certificate as a new yaml list element in your `ipsec-addon.yml`.
  For example:
  <pre>
  <strong>ca_certificates</strong>:
      \- |
         -----BEGIN CERTIFICATE-----
         ...
         -----END CERTIFICATE-----
      \- |
         -----BEGIN CERTIFICATE-----
         ...
         -----END CERTIFICATE-----
         .
         .
         .
  </pre>

1. Update the runtime config by running one of the following commands:
  * **For Ops Manager v1.10 or earlier:** 
    `bosh update runtime-config PATH_TO_SAVE_THE_RUNTIME_CONFIG`<br><br>
  * **For Ops Manager v1.11 or later:**
    `bosh2 -e BOSH_ENVIRONMENT update-runtime-config PATH_TO_SAVE_THE_RUNTIME_CONFIG`<br>

    <p class="note"><strong>Note</strong>: This step results in a few minutes of app downtime. </p>

1. Navigate to your Ops Manager interface in a browser, and click **Apply Changes**.

1. Generate a new certificate and use your new IPsec CA certificate to sign the new certificate.

1. Update the instance certificate and the private key fields in the YAML file with new values from above.

1. Repeat step 3 to update the runtime config.

1. Navigate to your Ops Manager interface in a browser, and click **Apply Changes**.

1. Delete the older CA certificate in the `ipsec-addon.yml` file.

1. Repeat step 3 to update the runtime config.

1. Navigate to your Ops Manager interface in a browser, and click **Apply Changes**.

